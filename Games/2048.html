<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>2048 Neon Slide</title>
    <style>
        :root {
            --bg-color: #05050a;
            --accent: #00d2ff;
            --tile-size: 70px;
            --gap: 12px;
            --grid-size: calc(var(--tile-size) * 4 + var(--gap) * 5);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; touch-action: none; }

        body {
            margin: 0; padding: 0; background-color: var(--bg-color); color: white;
            font-family: 'Segoe UI', sans-serif;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100dvh; overflow: hidden;
        }

        .bg-blur {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            filter: blur(60px); opacity: 0.3;
            background: radial-gradient(circle at 10% 20%, #ff007a 0%, transparent 40%),
                        radial-gradient(circle at 90% 80%, #00d2ff 0%, transparent 40%);
        }

        .header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .score-box { 
            background: rgba(255,255,255,0.05); 
            padding: 10px 25px; 
            border-radius: 12px; 
            text-align: center; 
            border: 1px solid rgba(255,255,255,0.1); 
            backdrop-filter: blur(10px); 
        }

        #score { font-size: 24px; font-weight: 900; color: var(--accent); margin: 0; text-shadow: 0 0 10px rgba(0,210,255,0.5); }

        .btn-reset-top {
            background: rgba(0, 210, 255, 0.1);
            border: 1px solid var(--accent);
            color: var(--accent);
            padding: 10px 15px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            transition: 0.2s;
        }
        .btn-reset-top:active { background: var(--accent); color: white; transform: scale(0.95); }

        /* Grade do Jogo */
        #game-board {
            position: relative;
            width: var(--grid-size);
            height: var(--grid-size);
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        /* Slots de fundo fixos */
        .grid-placeholder {
            position: absolute;
            width: var(--tile-size);
            height: var(--tile-size);
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        /* Peças Reais (Deslizantes) */
        .tile {
            position: absolute;
            width: var(--tile-size);
            height: var(--tile-size);
            border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            font-size: 24px; font-weight: bold;
            z-index: 10;
            transition: transform 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            will-change: transform;
        }

        .tile-inner {
            width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            border-radius: inherit;
            animation: appear 0.2s ease-out forwards;
        }

        @keyframes appear { from { scale: 0.5; opacity: 0; } to { scale: 1; opacity: 1; } }
        @keyframes pop { 0% { scale: 1; } 50% { scale: 1.15; } 100% { scale: 1; } }

        /* Indicador de pontos ganhos com contorno mais visível */
        .floating-points {
            position: absolute;
            color: #ffffff; /* Mudado para branco puro para destaque */
            font-weight: 900;
            font-size: 22px;
            pointer-events: none;
            z-index: 100;
            animation: floatUp 0.8s ease-out forwards;
            /* Outline branca/brilhante usando text-shadow múltiplo */
            text-shadow: 
                -1px -1px 0 var(--accent),  
                 1px -1px 0 var(--accent),
                -1px  1px 0 var(--accent),
                 1px  1px 0 var(--accent),
                 0 0 12px rgba(0, 210, 255, 0.8);
        }

        @keyframes floatUp {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-50px) scale(1.2); opacity: 0; }
        }

        /* Cores Neon */
        .tile-2 .tile-inner { background: #eee4da; color: #776e65; }
        .tile-4 .tile-inner { background: #ede0c8; color: #776e65; }
        .tile-8 .tile-inner { background: #f2b179; color: white; box-shadow: 0 0 15px #f2b179; }
        .tile-16 .tile-inner { background: #f59563; color: white; box-shadow: 0 0 15px #f59563; }
        .tile-32 .tile-inner { background: #f67c5f; color: white; box-shadow: 0 0 15px #f67c5f; }
        .tile-64 .tile-inner { background: #f65e3b; color: white; box-shadow: 0 0 15px #f65e3b; }
        .tile-128 .tile-inner { background: #edcf72; color: white; box-shadow: 0 0 20px #edcf72; font-size: 20px; }
        .tile-256 .tile-inner { background: #edcc61; color: white; box-shadow: 0 0 20px #edcc61; font-size: 20px; }
        .tile-512 .tile-inner { background: var(--accent); color: white; box-shadow: 0 0 25px var(--accent); }
        .tile-1024 .tile-inner { background: #38bdf8; color: white; font-size: 18px; }
        .tile-2048 .tile-inner { background: #a855f7; color: white; font-size: 18px; box-shadow: 0 0 30px #a855f7; }

        /* Game Over Overlay */
        #game-over {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(5, 5, 10, 0.85);
            backdrop-filter: blur(8px);
            z-index: 200;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            animation: fadeIn 0.4s ease;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        #game-over h2 { color: #ff007a; font-size: 32px; margin-bottom: 20px; text-shadow: 0 0 15px #ff007a; }

        .btn-restart {
            background: var(--accent);
            border: none;
            color: white;
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 0 20px var(--accent);
        }

        /* VFX Partículas */
        .particle {
            position: absolute; pointer-events: none; border-radius: 50%;
            z-index: 100; animation: particle-fade 0.5s ease-out forwards;
        }
        @keyframes particle-fade { to { transform: translate(var(--tx), var(--ty)); opacity: 0; } }

        /* Controles */
        .controls { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 30px; }
        .btn-ctrl { 
            width: 65px; height: 65px; background: rgba(255,255,255,0.08); 
            border: 1px solid rgba(255,255,255,0.2); color: white; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; font-size: 22px;
            transition: 0.1s; cursor: pointer; backdrop-filter: blur(5px);
        }
        .btn-ctrl.active { background: var(--accent); box-shadow: 0 0 25px var(--accent); transform: scale(0.9); border-color: white; }

        @media (max-width: 400px) {
            :root { --tile-size: 60px; --gap: 10px; }
        }
    </style>
</head>
<body>
    <div class="bg-blur"></div>
    
    <div class="header">
        <div class="score-box">
            <div style="font-size: 10px; opacity: 0.6; letter-spacing: 1px;">PONTOS</div>
            <p id="score">0</p>
        </div>
        <button class="btn-reset-top" onclick="restartGame()">NOVO JOGO</button>
    </div>

    <div id="game-board">
        <div id="game-over">
            <h2>FIM DE JOGO</h2>
            <button class="btn-restart" onclick="restartGame()">TENTAR NOVAMENTE</button>
        </div>
    </div>

    <div class="controls">
        <div style="visibility:hidden"></div>
        <button id="btn-up" class="btn-ctrl" onpointerdown="handleMove('up')">▲</button>
        <div style="visibility:hidden"></div>
        <button id="btn-left" class="btn-ctrl" onpointerdown="handleMove('left')">◀</button>
        <button id="btn-down" class="btn-ctrl" onpointerdown="handleMove('down')">▼</button>
        <button id="btn-right" class="btn-ctrl" onpointerdown="handleMove('right')">▶</button>
    </div>

<script>
    const board = document.getElementById('game-board');
    const scoreEl = document.getElementById('score');
    const gameOverOverlay = document.getElementById('game-over');
    let grid = Array(4).fill().map(() => Array(4).fill(null));
    let score = 0;
    let isMoving = false;

    function getPos(pos) {
        const root = document.querySelector(':root');
        const style = getComputedStyle(root);
        const size = parseInt(style.getPropertyValue('--tile-size'));
        const gap = parseInt(style.getPropertyValue('--gap'));
        return pos * (size + gap) + gap;
    }

    function init() {
        const placeholders = document.querySelectorAll('.grid-placeholder');
        placeholders.forEach(p => p.remove());
        const tiles = document.querySelectorAll('.tile');
        tiles.forEach(t => t.remove());

        for(let r=0; r<4; r++) {
            for(let c=0; c<4; c++) {
                const p = document.createElement('div');
                p.className = 'grid-placeholder';
                p.style.top = getPos(r) + 'px';
                p.style.left = getPos(c) + 'px';
                board.appendChild(p);
            }
        }
        grid = Array(4).fill().map(() => Array(4).fill(null));
        score = 0;
        gameOverOverlay.style.display = 'none';
        addRandomTile();
        addRandomTile();
        updateBoard();
    }

    function restartGame() {
        init();
    }

    function addRandomTile() {
        let empty = [];
        for(let r=0; r<4; r++) for(let c=0; c<4; c++) if(!grid[r][c]) empty.push({r,c});
        if(empty.length) {
            let {r,c} = empty[Math.floor(Math.random()*empty.length)];
            const val = Math.random() < 0.9 ? 2 : 4;
            grid[r][c] = {
                val: val,
                r: r,
                c: c,
                id: 't' + Date.now() + Math.random().toString(36).substr(2, 5)
            };
        }
    }

    function updateBoard() {
        const activeIds = grid.flat().filter(t => t).map(t => t.id);
        const currentTiles = document.querySelectorAll('.tile');
        currentTiles.forEach(t => { if(!activeIds.includes(t.id)) t.remove(); });

        grid.flat().forEach(tile => {
            if(!tile) return;
            let el = document.getElementById(tile.id);
            if(!el) {
                el = document.createElement('div');
                el.className = `tile tile-${tile.val}`;
                el.id = tile.id;
                el.innerHTML = `<div class="tile-inner">${tile.val}</div>`;
                board.appendChild(el);
            }
            
            el.style.transform = `translate(${getPos(tile.c)}px, ${getPos(tile.r)}px)`;
            
            const inner = el.querySelector('.tile-inner');
            if(inner.textContent != tile.val) {
                inner.textContent = tile.val;
                el.className = `tile tile-${tile.val}`;
                inner.style.animation = 'none';
                inner.offsetHeight;
                inner.style.animation = 'pop 0.2s ease-out';
                createParticles(getPos(tile.c) + 35, getPos(tile.r) + 35);
            }
        });
        scoreEl.textContent = score;
    }

    function showFloatingPoints(val, r, c) {
        const floating = document.createElement('div');
        floating.className = 'floating-points';
        floating.textContent = `+${val}`;
        
        // Ajuste fino para centralizar melhor o indicador de pontos
        const x = getPos(c) + 10;
        const y = getPos(r) + 15;
        
        floating.style.left = x + 'px';
        floating.style.top = y + 'px';
        
        board.appendChild(floating);
        setTimeout(() => floating.remove(), 800);
    }

    function createParticles(x, y) {
        for(let i=0; i<10; i++) {
            const p = document.createElement('div');
            p.className = 'particle';
            p.style.left = x + 'px'; p.style.top = y + 'px';
            p.style.width = p.style.height = Math.random() * 5 + 2 + 'px';
            p.style.background = '#00d2ff';
            p.style.setProperty('--tx', (Math.random()-0.5) * 120 + 'px');
            p.style.setProperty('--ty', (Math.random()-0.5) * 120 + 'px');
            board.appendChild(p);
            setTimeout(() => p.remove(), 500);
        }
    }

    function canMove() {
        for(let r=0; r<4; r++) {
            for(let c=0; c<4; c++) {
                if(!grid[r][c]) return true;
                if(r < 3 && grid[r+1][c] && grid[r][c].val === grid[r+1][c].val) return true;
                if(c < 3 && grid[r][c+1] && grid[r][c].val === grid[r][c+1].val) return true;
            }
        }
        return false;
    }

    function handleMove(dir) {
        if(isMoving || gameOverOverlay.style.display === 'flex') return;
        let moved = false;

        const vector = { up: {r:-1, c:0}, down: {r:1, c:0}, left: {r:0, c:-1}, right: {r:0, c:1} }[dir];
        const rows = (dir === 'down') ? [3,2,1,0] : [0,1,2,3];
        const cols = (dir === 'right') ? [3,2,1,0] : [0,1,2,3];

        grid.flat().forEach(t => { if(t) t.merged = false; });

        rows.forEach(r => {
            cols.forEach(c => {
                const tile = grid[r][c];
                if(tile) {
                    let currR = r, currC = c;
                    while(true) {
                        let nextR = currR + vector.r, nextC = currC + vector.c;
                        if(nextR < 0 || nextR >= 4 || nextC < 0 || nextC >= 4) break;
                        
                        let target = grid[nextR][nextC];
                        if(!target) {
                            grid[nextR][nextC] = tile;
                            grid[currR][currC] = null;
                            tile.r = nextR; tile.c = nextC;
                            currR = nextR; currC = nextC;
                            moved = true;
                        } else if(target.val === tile.val && !target.merged) {
                            grid[currR][currC] = null;
                            target.val *= 2;
                            target.merged = true;
                            score += target.val;
                            moved = true;
                            showFloatingPoints(target.val, nextR, nextC);
                            break;
                        } else break;
                    }
                }
            });
        });

        if(moved) {
            isMoving = true;
            updateBoard();
            setTimeout(() => {
                addRandomTile();
                updateBoard();
                isMoving = false;
                if(!canMove()) gameOverOverlay.style.display = 'flex';
            }, 160);
        }
    }

    window.addEventListener('keydown', e => {
        const k = e.key.toLowerCase();
        let b = null;
        if(k === 'w' || e.key === 'ArrowUp') { handleMove('up'); b = 'btn-up'; }
        else if(k === 's' || e.key === 'ArrowDown') { handleMove('down'); b = 'btn-down'; }
        else if(k === 'a' || e.key === 'ArrowLeft') { handleMove('left'); b = 'btn-left'; }
        else if(k === 'd' || e.key === 'ArrowRight') { handleMove('right'); b = 'btn-right'; }
        if(b) {
            const el = document.getElementById(b);
            el.classList.add('active');
            setTimeout(() => el.classList.remove('active'), 100);
        }
    });

    init();
</script>
</body>
</html>